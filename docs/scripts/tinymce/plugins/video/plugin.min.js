!function(e){"use strict";function t(e){var t={};return t.url=e,n.forEach(function(i){var o=n[i],r=e.match(o.pattern);if(r){t.provider=i,t.id=r[1],t.url=o.api+t.id;var a=r[2]||"";a.split("&").forEach(function(e){var i=e.split("=");t[i[0]]=i[1]})}}),t}function i(e,t){this.showDialog=this.showDialog.bind(this),this.render=this.render.bind(this);var i=this;i.editor=e;var o=n.map(function(e){var t=n[e],i='iframe[src*="'+t.api+'"]';return i+=',[data-mce-p-src*="'+t.api+'"]'}).join(",");e.addButton("video",{image:t+"/img/icons/video.svg",tooltip:"Insert/edit video",stateSelector:o,onclick:i.showDialog}),e.addMenuItem("video",{image:t+"/img/icons/video.svg",text:"Video",onclick:i.showDialog,context:"insert"})}var n=["youtube","vimeo"];n.youtube={pattern:/youtu(?:\.be|be\.com)\/(?:watch\?v=|embed\/)?([a-z0-9\-_]+)(?:\?|&)?(.+)?/i,api:"//www.youtube.com/embed/",options:[{name:"rel",type:"checkbox",text:"Show suggested videos when the video finishes"},{name:"controls",type:"checkbox",text:"Show player controls"},{name:"showinfo",type:"checkbox",text:"Show video title and player actions"}]},n.vimeo={pattern:/(?:player.)?vimeo.com\/(?:video\/)?([0-9]+)(?:\?|&)?(.+)?/,api:"//player.vimeo.com/video/",options:[{name:"portrait",type:"checkbox",text:"Show portrait in overlay"},{name:"title",type:"checkbox",text:"Show title in overlay"},{name:"byline",type:"checkbox",text:"Show byline in overlay"}]},i.prototype.showDialog=function(){var i=this.editor,n=i.dom,o=this.data={},r=i.selection.getNode();if(r){var a=n.getAttrib(r,"src");a||(r=r.children[0],a=n.getAttrib(r,"src")),o=this.data=e.extend({},o,t(a));var h=n.getAttrib(r,"allowfullscreen");h&&(o.fullscreen=1),o.width=n.getAttrib(r,"width"),o.height=n.getAttrib(r,"height")}o.width||(o.width=400),o.height||(o.height=300),this.window=null,this.window=this.editor.windowManager.open({title:"Insert a video",data:o,body:[{type:"textbox",subtype:"url",label:"Source",ariaLabel:"Source",name:"url",maxLength:256,size:50,onchange:this.render},{type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:this.render,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:this.render,ariaLabel:"Height"},{name:"fullscreen",type:"checkbox",text:"Allow fullscreen",onchange:this.render}]},{type:"container",label:"Options",name:"options"},{type:"container",name:"preview"}],onsubmit:this.onsubmit.bind(this)}),this.render()},i.prototype.render=function(){var i=this.data||{},o=this.html(!0),r=this.window,a=this;if(r){r.find("*").each(function(e){var t=e.name();t&&(i[t]=e.value())});var h=i.url;if(!h)return"";i=this.data=e.extend({},i,t(h));var s=r.find("#options")[0];s.items().remove();var d=n[i.provider].options.map(function(t){t=e.extend({},t,{onchange:a.render});var n=i[t.name];return"0"!==n&&n!==!1&&(t.checked=!0),t}),c=s.getEl("body");c.style.width="",c.style.height="",s.append(d),s.updateLayoutRect(),s.parentsAndSelf().each(function(e){e.reflow()}),o=this.html(!0);var l=r.find("#preview")[0];l.innerHtml(o).updateLayoutRect(),l.parentsAndSelf().each(function(e){e.reflow()})}return o},i.prototype.html=function(e){var t=this.data||{};if(!t.id)return"";var i=t.url,o=n[t.provider].options||[],r=[];o.forEach(function(e){var i=e.name,n=t[i];"0"!==n&&n!==!1||r.push(i+"=0")}),r.length&&(i+="?"+r.join("&"));var a=t.width,h=t.height,s='<iframe src="'+i+'" width="'+a+'" height="'+h+'"';return t.fullscreen&&(s+=" allowfullscreen"),e&&(s+=' style="width: '+a+"px; height: "+h+'px;"'),s+=" />"},i.prototype.onsubmit=function(){this.editor.insertContent(this.html())},e.create("tinymce.plugins.Video",{init:function(e,t){return new i(e,t)},getInfo:function(){return{longname:"Video - Add embeded video easily.",author:"BrandExtract",authorurl:"http://www.brandextract.com",version:"0.1.0"}}}),e.PluginManager.add("video",e.plugins.Video)}(window.tinymce);
//# sourceMappingURL=plugin.js.map